<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://sheets.googleapis.com https://drive.google.com 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://api.emailjs.com; img-src * 'self' data: https:;">
    <title>Ramen Ta Nouille - Recettes</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <img src="logo.png" alt="Ramen Ta Nouille" class="logo">
        <h1>Recettes Ramen Ta Nouille</h1>
        <div id="recipe-counter" class="counter">
            Recettes affichées : <span>0</span>
        </div>
    </header>

    <div class="main-container">
        <section class="filters" id="filters">
            <h2>Filtres</h2>
            
            <div class="filter-group">
                <h3>Régime alimentaire</h3>
                <label><input type="checkbox" name="regime" value="Sans restriction"> Sans restriction</label>
                <label><input type="checkbox" name="regime" value="Véganisme"> Véganisme</label>
                <label><input type="checkbox" name="regime" value="Végétarisme"> Végétarisme</label>
                <label><input type="checkbox" name="regime" value="Sans gluten"> Sans gluten</label>
                <p class="info-message">
                    ⚠️ Seulement l'option "Sans gluten" peut être combinée au végétarisme et au véganisme.<br>
                    Les autres options ne peuvent pas être combinées.
                </p>
            </div>

            <div class="filter-group">
                <h3>Type de portion</h3>
                <label><input type="checkbox" name="portion" value="Plat à partager"> Plat à partager</label>
                <label><input type="checkbox" name="portion" value="Portions individuelles"> Portions individuelles</label>
            </div>

            <div class="filter-group">
                <h3>Type de plat</h3>
                <label><input type="checkbox" name="type" value="Entrée"> Entrée</label>
                <label><input type="checkbox" name="type" value="Plat principal"> Plat principal</label>
                <label><input type="checkbox" name="type" value="Dessert"> Dessert</label>
            </div>

            <div class="filter-group">
                <h3>Niveau de piment</h3>
                <label><input type="checkbox" name="spicy" value="Non pimenté"> Non pimenté</label>
                <label><input type="checkbox" name="spicy" value="🌶️ Léger"> 🌶️ Léger</label>
                <label><input type="checkbox" name="spicy" value="🌶️🌶️ Moyen"> 🌶️🌶️ Moyen</label>
                <label><input type="checkbox" name="spicy" value="🌶️🌶️🌶️ Fort"> 🌶️🌶️🌶️ Fort</label>
            </div>
        </section>

        <main id="recipes-container">
            <!-- Les recettes seront ajoutées ici dynamiquement -->
        </main>
    </div>

    <!-- Bouton panier -->
    <button id="cartToggle" class="cart-toggle">
        🛒 <span class="cart-count">0</span>
    </button>

    // Dans la gestion du formulaire de commande
document.getElementById('order-form').addEventListener('submit', (event) => {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    // Formatage des items pour le template
    const itemsList = allRecipes
        .filter(recipe => recipe.quantity > 0)
        .map(recipe => ({
            title: recipe['Titre de la recette'],
            quantity: recipe.quantity
        }));

    const orderDetails = {
        customerName: formData.get('name'),
        phone: formData.get('phone'),
        email: formData.get('email'),
        deliveryType: formData.get('delivery-type') === 'pickup' ? 'À venir chercher' : 'Livraison',
        deliveryAddress: formData.get('delivery-address'),
        deliveryDate: new Date(formData.get('delivery-date')).toLocaleDateString('fr-FR'),
        deliveryTime: formData.get('delivery-time'),
        items_str: itemsList.map(item => `${item.title}: ${item.quantity}`).join('\n'),
        items: itemsList
    };

    emailjs.send('service_hdwid4k', 'template_k2nup5c', orderDetails)
        .then(response => {
            console.log('Commande envoyée', response.status, response.text);
            alert('Votre commande a été envoyée avec succès !');
            form.reset();
            allRecipes.forEach(recipe => recipe.quantity = 0);
            updateCart();
            displayRecipes(filterRecipes());
        })
        .catch(error => {
            console.error('Erreur', error);
            alert('Une erreur est survenue, veuillez réessayer.');
        });
});

    <footer>
        <p>&copy; 2023 Ramen Ta Nouille. Tous droits réservés.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        (function() {
            emailjs.init("bk_ggFzaD16z5Go8f");
        })();
    </script>
    <script src="script.js"></script>
</body>
</html>